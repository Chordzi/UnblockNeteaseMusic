{"version":3,"sources":["../../../src/modules/utils/index.js"],"names":["Utils","ip","forceIp","netease","kugou","dongting","qq","songId","self","resolve","reject","getSongDetail","detail","songName","getSongName","artist","getArtistName","songInfo","search","getUrl","hash","url","console","log"],"mappings":";;;;;;;;;;;;;;;;;;;;;;AAAA;;;;AACA;;;;AAEA;;;;AACA;;;;AACA;;;;AACA;;;;;;IAEqBA,K;AACnB,mBAAc;AAAA;;AACZ,QAAIC,KAAK,iBAAOC,OAAP,GAAiB,iBAAOA,OAAxB,GAAkC,eAA3C;;AAEA,SAAKC,OAAL,GAAe,sBAAYF,EAAZ,CAAf;AACA,SAAKG,KAAL,GAAa,IAAb;AACA,SAAKC,QAAL,GAAgB,IAAhB;;AAEA,QAAI,iBAAOD,KAAX,EAAkB;AAChB,WAAKA,KAAL,GAAa,qBAAb;AACD;AACD,QAAI,iBAAOC,QAAX,EAAqB;AACnB,WAAKA,QAAL,GAAgB,IAAIA,QAAJ,EAAhB;AACD;AACD,QAAI,iBAAOC,EAAX,EAAe;AACb,WAAKA,EAAL,GAAU,kBAAV;AACD;AACF;;AAED;;;;;;;+BAGWC,M,EAAQ;AACjB,UAAIC,OAAO,IAAX;;AAEA,aAAO,sBAAY,iBAAeC,OAAf,EAAwBC,MAAxB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,mDAGIF,KAAKL,OAAL,CAAaQ,aAAb,CAA2BJ,MAA3B,CAHJ;;AAAA;AAGXK,sBAHW;AAIXC,wBAJW,GAIAL,KAAKL,OAAL,CAAaW,WAAb,CAAyBF,MAAzB,CAJA;AAKXG,sBALW,GAKFP,KAAKL,OAAL,CAAaa,aAAb,CAA2BJ,MAA3B,CALE;AAMXK,wBANW,GAMA,IANA;;AAAA,qBAQXT,KAAKF,EARM;AAAA;AAAA;AAAA;;AAAA;AAAA,mDASIE,KAAKF,EAAL,CAAQY,MAAR,CAAeL,QAAf,EAAyBE,MAAzB,CATJ;;AAAA;AASbE,wBATa;;AAAA;AAAA,sBAYX,CAACA,QAAD,IAAaT,KAAKJ,KAZP;AAAA;AAAA;AAAA;;AAAA;AAAA,mDAcII,KAAKJ,KAAL,CAAWc,MAAX,CAAkBL,QAAlB,EAA4BE,MAA5B,CAdJ;;AAAA;AAcbE,wBAda;;AAAA,qBAeTA,QAfS;AAAA;AAAA;AAAA;;AAAA;AAAA,mDAgBUT,KAAKJ,KAAL,CAAWe,MAAX,CAAkBF,SAASG,IAA3B,CAhBV;;AAAA;AAgBXH,yBAASI,GAhBE;;AAAA;AAAA,qBAoBXJ,QApBW;AAAA;AAAA;AAAA;;AAAA,iDAqBNR,QAAQQ,QAAR,CArBM;;AAAA;AAAA,iDAuBNR,QAAQ,IAAR,CAvBM;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AA0Bfa,wBAAQC,GAAR;AA1Be,iDA2BRb,mBA3BQ;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OAAZ,CAAP;AA8BD;;;;;kBAvDkBV,K","file":"index.js","sourcesContent":["import colors from 'colors';\nimport co from 'co';\n\nimport config from '../config';\nimport netease from './netease';\nimport kugou from './kugou';\nimport qq from './qq';\n\nexport default class Utils {\n  constructor() {\n    let ip = config.forceIp ? config.forceIp : '223.252.199.7';\n\n    this.netease = new netease(ip);\n    this.kugou = null;\n    this.dongting = null;\n\n    if (config.kugou) {\n      this.kugou = new kugou();\n    }\n    if (config.dongting) {\n      this.dongting = new dongting();\n    }\n    if (config.qq) {\n      this.qq = new qq();\n    }\n  }\n\n  /*\n    Get song url.\n  */\n  getUrlInfo(songId) {\n    let self = this;\n\n    return new Promise(async function(resolve, reject) {\n      // get song detail by song id from netease\n      try {\n        let detail = await self.netease.getSongDetail(songId);\n        let songName = self.netease.getSongName(detail);\n        let artist = self.netease.getArtistName(detail);\n        let songInfo = null;\n\n        if (self.qq) {\n          songInfo = await self.qq.search(songName, artist);\n        }\n\n        if (!songInfo && self.kugou) {\n          // search 'Artist Songname' on kugou\n          songInfo = await self.kugou.search(songName, artist);\n          if (songInfo) {\n            songInfo.url = await self.kugou.getUrl(songInfo.hash);\n          }\n        }\n\n        if (songInfo) {\n          return resolve(songInfo);\n        } else {\n          return resolve(null);\n        }\n      } catch(err) {\n        console.log(err);\n        return reject(err);\n      }\n    });\n  };\n}\n"]}